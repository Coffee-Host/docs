---
title: 資料庫設定
description: 將插件資料儲存到 MySQL/MariaDB，實現跨服資料同步
---

import { Callout } from "fumadocs-ui/components/callout";
import { Step, Steps } from "fumadocs-ui/components/steps";
import Image from "next/image";

<Callout title="為什麼使用資料庫？">
使用資料庫儲存資料有幾個好處：**跨服資料同步**（多個伺服器共用資料）、**更好的效能**（大量資料時）、**更安全的資料備份**。
</Callout>

# 資料庫基礎知識

## 檔案 vs 資料庫

| 項目 | 檔案儲存（預設） | 資料庫儲存 |
|------|------------------|------------|
| 設定難度 | ⭐ 簡單 | ⭐⭐⭐ 中等 |
| 跨服同步 | ❌ 不支援 | ✅ 支援 |
| 效能（大量資料） | ⚠️ 較慢 | ✅ 較快 |
| 備份便利性 | ⭐⭐ 一般 | ⭐⭐⭐ 方便 |

## 常見資料庫類型

| 資料庫 | 說明 |
|--------|------|
| **MySQL** | 最常用，大多數插件支援 |
| **MariaDB** | MySQL 的開源分支，完全相容 |
| **SQLite** | 輕量級，單檔案，部分插件支援 |
| **H2** | 輕量級，常見於較新插件 |

# 取得資料庫

## CoffeeHost 資料庫

如果您使用 CoffeeHost 主機，可以在面板中建立 MySQL 資料庫。

<Steps>
    <Step>

    ### 進入資料庫頁面

    在控制面板側邊欄點擊「**資料庫**」。

    <Image src="/images/practice/database/panel-database.png" alt="資料庫頁面" width={800} height={600} />

    </Step>

    <Step>

    ### 建立資料庫

    點擊「**新增資料庫**」，輸入資料庫名稱。

    <Image src="/images/practice/database/create-database.png" alt="建立資料庫" width={800} height={600} />

    </Step>

    <Step>

    ### 取得連線資訊

    建立後會顯示以下資訊：
    - **主機（Host）**：資料庫伺服器位址
    - **連接埠（Port）**：3306（MySQL 預設）
    - **資料庫名稱（Database）**
    - **使用者名稱（Username）**
    - **密碼（Password）**

    <Callout type="warn">
    請妥善保管密碼！如果遺失，可以重新生成。
    </Callout>

    </Step>

</Steps>

# LuckPerms 資料庫設定

LuckPerms 支援 MySQL 儲存，適合跨服同步權限。

編輯 `plugins/LuckPerms/config.yml`：

```yaml
storage-method: MySQL

data:
  # 資料庫連線設定
  address: 127.0.0.1:3306
  database: luckperms
  username: your_username
  password: your_password

  # 連線池設定（通常不需修改）
  pool-settings:
    maximum-pool-size: 10
    minimum-idle: 10
    maximum-lifetime: 1800000
    connection-timeout: 5000
```

設定完成後重啟伺服器，LuckPerms 會自動建立所需的資料表。

# CMI 資料庫設定

CMI 可以將玩家資料儲存到 MySQL。

編輯 `plugins/CMI/config.yml`：

```yaml
mysql:
  enabled: true
  hostname: 127.0.0.1
  port: 3306
  database: cmi
  username: your_username
  password: your_password

  # 資料表前綴（多伺服器共用資料庫時使用）
  tablePrefix: cmi_

  # 連線設定
  useSSL: false
  autoReconnect: true
```

# EssentialsX 資料庫設定

EssentialsX 預設使用檔案儲存，但可以配合其他插件使用資料庫。

對於金錢資料，可以使用 Vault + CMI 經濟來實現資料庫儲存。

# CoreProtect 資料庫設定

CoreProtect（方塊記錄插件）在大型伺服器上建議使用 MySQL。

編輯 `plugins/CoreProtect/config.yml`：

```yaml
use-mysql: true
mysql-host: 127.0.0.1
mysql-port: 3306
mysql-database: coreprotect
mysql-username: your_username
mysql-password: your_password
```

# 跨服資料同步架構

使用資料庫可以實現多個伺服器共用資料：

```
          ┌─────────────┐
          │   MySQL     │
          │   資料庫     │
          └──────┬──────┘
                 │
     ┌───────────┼───────────┐
     │           │           │
     ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│ 生存服   │ │ 小遊戲服 │ │ 創造服   │
│ Server1 │ │ Server2 │ │ Server3 │
└─────────┘ └─────────┘ └─────────┘
     │           │           │
     └───────────┴───────────┘
              │
       玩家資料同步
    （金錢、權限、背包等）
```

## 常見跨服同步插件

| 插件 | 功能 | 資料庫支援 |
|------|------|------------|
| LuckPerms | 權限同步 | ✅ MySQL |
| CMI | 金錢、家 | ✅ MySQL |
| MySQLPlayerDataBridge | 背包、經驗 | ✅ MySQL |
| Plan | 統計數據 | ✅ MySQL |

# 資料庫維護

## 備份資料庫

使用 phpMyAdmin 或命令列備份：

```bash
mysqldump -u username -p database_name > backup.sql
```

## 清理舊資料

部分插件（如 CoreProtect）會累積大量資料，定期清理可以節省空間：

```
# CoreProtect 清理 30 天前的資料
/co purge t:30d
```

## 監控資料庫大小

在 phpMyAdmin 或面板中查看各資料表的大小，找出佔用空間最多的資料。

<Callout type="info" title="資料庫效能">
如果資料庫變慢，可能是資料量過大。考慮：
1. 定期清理舊資料
2. 優化資料表（OPTIMIZE TABLE）
3. 增加資料庫伺服器資源
</Callout>

# 常見問題

## 連線失敗怎麼辦？

1. **檢查連線資訊**：確認主機、連接埠、使用者名稱、密碼正確
2. **檢查防火牆**：確認資料庫允許外部連線
3. **檢查權限**：確認資料庫使用者有足夠權限

## 資料沒有同步？

1. 確認所有伺服器都使用相同的資料庫設定
2. 確認資料表前綴相同
3. 部分插件需要重啟才會同步

## 切換到資料庫會丟失資料嗎？

大多數插件在切換儲存方式時不會自動遷移資料。建議：
1. 先備份現有資料
2. 查閱插件文件了解遷移方式
3. 部分插件提供遷移指令（如 LuckPerms 的 `/lp migration`）
